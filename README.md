# Intrusion Detection and Prevention Systems

This exercise focuses on real-time network analysis to identify suspicious behavior. It involves using common cybersecurity tools to examine network traffic, detect unusual activity, and extract information contained within the network data.

This lab consists of four sections:

**Section 1**: Installation and setup of Suricata, an open-source, high-performance network threat detection engine used for IDS, IPS, and NSM, along with Evebox, a GUI tool for managing and analyzing security events generated by Suricata.
 
**Section 2**: Analysis of a pcap file from January 2023 showing evidence of malware infection by AgentTesla. It demonstrates scanning the pcap file with Suricata and using Evebox to investigate alerts.
 
**Section 3**: Similar analysis process using Suricata and Evebox to uncover evidence of IcedID malware.
 
**Section 4**: Repetition of the process to identify the presence of AZORult malware.
 
The lab emphasizes using Suricata and Evebox for effective network threat detection and investigation.

<details>
  <summary><b>SECTION 1: Suricata and Evebox</b></summary>

Section1:
1. Install Suricata.
   
![image](https://github.com/user-attachments/assets/37c55d9d-83f8-4252-a74b-204e13833cdb)                     
*Figure 1 Instructions for installing Suricata onto Ubuntu*

2. Run ‘sudo suricata-update’

![image](https://github.com/user-attachments/assets/90f8b530-7f37-4675-8442-019c642e5cb6)       
*Figure 2 Suricata updated rules*
 
3. Install Evebox.
   
![image](https://github.com/user-attachments/assets/4ff89ec2-c8a4-4099-9f3e-d1de74b9e88f)  
*Figure 3 Evebox installation instructions*

![image](https://github.com/user-attachments/assets/82b1022b-7a23-4c90-944b-770e6cefca79)    
*Figure 4 Evebox Installation continued*

4. Suricata Ingest Script was obtained from   https://gist.github.com/jstrosch/317a03ad5cd9772685eb4f2020f4611e

 ![image](https://github.com/user-attachments/assets/6784c325-dc70-40e1-bd8f-b40a87b44868)  
 *Figure 5 Suricate Ingest File*

5. Run ‘sudo sh ./suri-ingest-pcap.sh yourPCAP.pcap’
   
 ![image](https://github.com/user-attachments/assets/52441f22-58d7-4d36-9e77-375ebd316544)   
 *Figure 6 Malware AgentTesla detected*

6. Evebox opened on browser: 127.0.01:5636/#/inbox

 ![image](https://github.com/user-attachments/assets/c629c79b-f0d8-4a1e-a39d-17ea797b27d7)    
 *Figure 7  Evebox Inbox*

  
</details>

<details>
  <summary><b>SECTION 2: Pcap Analysis</b></summary>

**1. When was the first and last event triggered?**
   
The first event was triggered at 2023-01-05 16:51:00.

The last event occurred at 2023-01-05 16:51:30.
![image](https://github.com/user-attachments/assets/c87cdcd2-cc01-4167-a12f-1a6b0e0875b2)

**2. Who is the victim?**

The victim’s information is listed below:

a. IP address: 204.11.58.28: [587]

![image](https://github.com/user-attachments/assets/e38a6283-0370-41af-af05-de3a97e28861)

b. Hostname: DESKTOP-WIN11PC
![image](https://github.com/user-attachments/assets/f64a0c6f-db42-4c20-baf5-3dc1268abb0e)

**3.Who is the attacker?** 

The attacker’s IP address is IP address: 192.168.1.27: [51958].

![image](https://github.com/user-attachments/assets/6aaedf66-c4a3-42cb-8006-e8a6069e5cc9)

a. Is the malware family identified?

The malware family was identified as AgentTesla.

![image](https://github.com/user-attachments/assets/c114e3c8-8c6d-41f2-a232-9920555d5afa)

b. What do we know about them? Capabilities? Activity?

Agent Tesla operates as a Remote Access Trojan (RAT) and information stealer developed using the .NET framework. It is primarily spread through phishing emails and once is gains entry, it uses various techniques to hide its presence. It can log keystrokes, capture clipboard content, and scan the disk for sensitive data.

</details>

<details>
  <summary><b>SECTION 3: Malware: IcedID identification</b></summary>  
 
 **1.	When was the first and last event triggered?**  

The first event was triggered at 2023-04-19 09:32:20.   
![image](https://github.com/user-attachments/assets/ce4e6515-d9e0-4a9a-bb54-60df367de4c0)  
  
The last event occurred at 2023-01-05 15:17:46.    
![image](https://github.com/user-attachments/assets/2360e558-b8c0-4cee-81f4-9f663b4ea935)

**2.	Who is the victim?** 

The first victim’s IP address is 10.4.19.19: [53]  
![image](https://github.com/user-attachments/assets/cd035095-0c56-4d04-9298-96a76314602f)

The frame below looks a bit suspicious because it does have a clear SOURCE IP and a DESTINATION IP, as can be seen below.  
![image](https://github.com/user-attachments/assets/73ecbf2b-0aff-4ebc-86be-7907850748a2)

However, it’s evident in the picture below that the src_ip has two different IP addresses which should not be the case.   
![image](https://github.com/user-attachments/assets/567eaca0-586f-4848-a560-c6e4d3996e53)

The second victim’s IP address is 192.153.57.233:[80]   
![image](https://github.com/user-attachments/assets/32176a71-dca5-4eba-87b0-fb55186fb1e9)

The attack is being flagged as critical!  
![image](https://github.com/user-attachments/assets/0681c7ac-ecf4-4fe8-8d2d-6239781e001f)

**3.	Who is the attacker?**   

The attacker’s IP address is IP address: 10.4.19.136:[49805].  
![image](https://github.com/user-attachments/assets/ecdff8a8-885b-4b79-b3b6-3337bd81e5c4)

a.	Is the malware family identified?  
The malware family was identified as **IcedID**.   
![image](https://github.com/user-attachments/assets/a1873570-b5bd-4b8b-889b-72ccaa716342)

b.	What do we know about them? Capabilities? Activity?

IcedID is a modular banking malware designed to steal financial information, and it has been observed in active use since at least 2017. IcedID attacks primarily target banks in North America, along with a few specific banking organizations in the United Kingdom.

Its origins can be traced back to Eastern Europe where the criminals behind icedID are known to have worked with the creators of Emotet and TrickBot as well. IcedID also functions as a loader, capable of delivering other viruses or downloading additional modules.

  
</details>

<details>
  <summary><b>SECTION 4: Malware AZORult Identification</b></summary>

A pcap files from https://github.com/jstrosch/ps-suricata-lab, was downloaded and ran through suricata for evaluation sudo sh ./suri-ingest-pcap.sh demo-s04-01-arkeistealer-payloads-exfil.pcap. Evebox was then used to evaluate various incidents that was flagged. 
![image](https://github.com/user-attachments/assets/7c0f00cb-2eec-48f1-8974-846088f9f93e)

**1.	When was the first and last event triggered?**

The first event was triggered at 2020-08-29 21:321:34.
The last event occurred at 2020-08-29 21:33:25. 
![image](https://github.com/user-attachments/assets/e27c6cd6-69ba-4613-b4f5-6017f8c82695)

**2.	Who is the victim**

The victim’s IP address is 217.8.117.77: [80]  
![image](https://github.com/user-attachments/assets/17b2b260-64b0-4ff9-b815-80dabde5db7d)

**3.	Who is the attacker?** 

The attacker’s IP address is IP address: 192.168.56.101:[49284]. 
![image](https://github.com/user-attachments/assets/c589a8a8-4839-4cb7-aff4-e2a2e7759feb)

a.	Is the malware family identified?  
The malware family was identified as **AZORult**. 
![image](https://github.com/user-attachments/assets/9f1ad1f8-bcc3-4a12-8d70-c690117dee79)

Here it’s visible to see that hackers are trying to exfiltrate a file that appears to hold passwords.  
![image](https://github.com/user-attachments/assets/574bdd23-22ae-4d32-be45-d8a5f3eb6411)

Here, project.ug is shown at the host. This has been categorized as a high-risk site, specifically flagged as associated with "Command and Control & Botnet" activities. 
![image](https://github.com/user-attachments/assets/a9643a88-12c3-47af-bdaa-19e212a6e54d)

b.	What do we know about them? Capabilities? Activity? 

AZORult is capable of stealing sensitive banking information, including passwords, credit card details, and cryptocurrency. This frequently updated information-stealing malware remains a significant and active threat. 

AZORult was first discovered in 2016 and was advertised on some Russian underground forums. It targets and steals sensitive data such as IDs, browsing history, cookies, passwords, and more.  It can also download additional malware such as ransomware and cryptocurrency miners. 
  
</details>
